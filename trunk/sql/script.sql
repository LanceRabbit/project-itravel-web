USE [master]
GO
/****** Object:  Database [iiiTravel]    Script Date: 2014/9/8 下午 06:01:06 ******/
CREATE DATABASE [iiiTravel]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'iiiTravel', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\iiiTravel.mdf' , SIZE = 4160KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'iiiTravel_log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\iiiTravel_log.ldf' , SIZE = 1088KB , MAXSIZE = 2048GB , FILEGROWTH = 10%)
GO
ALTER DATABASE [iiiTravel] SET COMPATIBILITY_LEVEL = 110
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [iiiTravel].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [iiiTravel] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [iiiTravel] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [iiiTravel] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [iiiTravel] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [iiiTravel] SET ARITHABORT OFF 
GO
ALTER DATABASE [iiiTravel] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [iiiTravel] SET AUTO_CREATE_STATISTICS ON 
GO
ALTER DATABASE [iiiTravel] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [iiiTravel] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [iiiTravel] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [iiiTravel] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [iiiTravel] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [iiiTravel] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [iiiTravel] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [iiiTravel] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [iiiTravel] SET  DISABLE_BROKER 
GO
ALTER DATABASE [iiiTravel] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [iiiTravel] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [iiiTravel] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [iiiTravel] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [iiiTravel] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [iiiTravel] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [iiiTravel] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [iiiTravel] SET RECOVERY FULL 
GO
ALTER DATABASE [iiiTravel] SET  MULTI_USER 
GO
ALTER DATABASE [iiiTravel] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [iiiTravel] SET DB_CHAINING OFF 
GO
ALTER DATABASE [iiiTravel] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [iiiTravel] SET TARGET_RECOVERY_TIME = 0 SECONDS 
GO
EXEC sys.sp_db_vardecimal_storage_format N'iiiTravel', N'ON'
GO
USE [iiiTravel]
GO
/****** Object:  Table [dbo].[ACCOUNT]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ACCOUNT](
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[EMAIL] [varchar](50) NOT NULL,
	[PASSWORD] [varchar](11) NOT NULL,
	[NICKNAME] [varchar](10) NOT NULL,
	[ACCOUNT_LEVEL] [int] NULL,
	[LAST_LOGON_DT] [date] NULL,
	[IMAGE] [image] NULL,
	[BLACKLIST_LEVEL] [int] NULL,
 CONSTRAINT [PK__ACCOUNT__05B22F600C675B5A] PRIMARY KEY CLUSTERED 
(
	[ACCOUNT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[AD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[AD](
	[AD_ID] [varchar](8) NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
	[VALID_DAY] [date] NOT NULL,
	[AD_IMG] [image] NULL,
	[TEMP_AD_ID] [varchar](8) NOT NULL,
 CONSTRAINT [PK__AD__B5B611FBB61D2146] PRIMARY KEY CLUSTERED 
(
	[AD_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[BLACKLIST_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[BLACKLIST_RECORD](
	[REPORTER_ID] [varchar](9) NOT NULL,
	[REPORTED_ID] [varchar](9) NOT NULL,
	[COMMENT_ID] [varchar](12) NOT NULL,
	[REASON] [text] NULL,
	[REPORT_DT] [date] NULL,
 CONSTRAINT [PK_BLACKLIST_RECORD] PRIMARY KEY CLUSTERED 
(
	[REPORTER_ID] ASC,
	[REPORTED_ID] ASC,
	[COMMENT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[CODE_LIST]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[CODE_LIST](
	[CODE_HEAD] [varchar](4) NOT NULL,
	[YYMM] [varchar](4) NOT NULL,
	[SER_NO] [int] NOT NULL,
	[DESCRIPTION] [varchar](20) NULL,
 CONSTRAINT [PK_CODE_LIST] PRIMARY KEY CLUSTERED 
(
	[CODE_HEAD] ASC,
	[YYMM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[COUPONS]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[COUPONS](
	[COUPON_ID] [varchar](8) NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
	[COUPON_IMG] [image] NULL,
	[COUPON_DESCRIPTION] [text] NULL,
	[VALID_DAY] [date] NOT NULL,
	[TEMP_COUPON_ID] [varchar](8) NOT NULL,
 CONSTRAINT [PK__COUPONS__BEC7644113BE3EA3] PRIMARY KEY CLUSTERED 
(
	[COUPON_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SER_NO_LENGTH]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SER_NO_LENGTH](
	[CODE_HEAD] [varchar](4) NOT NULL,
	[DESCRIPTION] [varchar](20) NULL,
	[SER_NO_LENGTH] [int] NOT NULL,
 CONSTRAINT [PK_SER_NO] PRIMARY KEY CLUSTERED 
(
	[CODE_HEAD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SPOT_COLLECT_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SPOT_COLLECT_RECORD](
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
 CONSTRAINT [PK_SPOT_COLLECT_RECORD] PRIMARY KEY CLUSTERED 
(
	[ACCOUNT_ID] ASC,
	[SPOT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SPOT_COMMENT_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SPOT_COMMENT_RECORD](
	[COMMENT_ID] [varchar](12) NOT NULL,
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
	[COMMENT] [text] NOT NULL,
	[CMT_DT] [date] NOT NULL,
	[TEMP_COMMENT_ID] [varchar](12) NOT NULL,
 CONSTRAINT [PK_SPOT_COMMENT_RECORD] PRIMARY KEY CLUSTERED 
(
	[COMMENT_ID] ASC,
	[ACCOUNT_ID] ASC,
	[SPOT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SPOT_DETAIL]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SPOT_DETAIL](
	[SPOT_ID] [varchar](11) NOT NULL,
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[LEADER] [varchar](10) NULL,
	[SPOT_NAME] [varchar](50) NOT NULL,
	[CITY_ID] [int] NOT NULL,
	[ADDRESS] [varchar](50) NULL,
	[PHONE] [varchar](30) NULL,
	[LONGITUDE] [float] NULL,
	[LATITUDE] [float] NULL,
	[SPOT_INTRO] [text] NULL,
	[LIKE_COUNT] [int] NULL,
	[CATEGORY_ID] [int] NOT NULL,
	[SUBCATEGORY_ID] [varchar](3) NOT NULL,
	[TEMP_SPOT_ID] [varchar](11) NOT NULL,
 CONSTRAINT [PK_SPOT_DETAIL] PRIMARY KEY CLUSTERED 
(
	[SPOT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SPOT_IMG]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SPOT_IMG](
	[IMG_ID] [varchar](11) NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
	[SPOT_IMG] [image] NULL,
	[IMG_ORDER] [int] NULL,
	[TEMP_IMG_ID] [varchar](11) NOT NULL,
 CONSTRAINT [PK__SPOT_IMG__7E0892D95375FD5D] PRIMARY KEY CLUSTERED 
(
	[IMG_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SPOT_LIKE_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SPOT_LIKE_RECORD](
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
 CONSTRAINT [PK_SPOT_LIKE_RECORD] PRIMARY KEY CLUSTERED 
(
	[ACCOUNT_ID] ASC,
	[SPOT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[SPOT_OWNER]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[SPOT_OWNER](
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[OWNER_NAME] [varchar](50) NULL,
 CONSTRAINT [PK_SPOT_OWNER] PRIMARY KEY CLUSTERED 
(
	[ACCOUNT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TRIP]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TRIP](
	[TRIP_ID] [varchar](9) NOT NULL,
	[TRIP_NAME] [varchar](30) NULL,
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[TOTAL_DAY] [int] NULL,
	[START_DATE] [date] NOT NULL,
	[LIKE_COUNT] [int] NULL,
	[TEMP_TRIP_ID] [varchar](9) NOT NULL,
 CONSTRAINT [PK__TRIP__92362727E4B2669E] PRIMARY KEY CLUSTERED 
(
	[TRIP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TRIP_COLLECT_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TRIP_COLLECT_RECORD](
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[TRIP_ID] [varchar](9) NOT NULL,
 CONSTRAINT [PK_TRIP_COLLECT_RECORD] PRIMARY KEY CLUSTERED 
(
	[ACCOUNT_ID] ASC,
	[TRIP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TRIP_DETAIL]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TRIP_DETAIL](
	[TRIP_DETAIL_ID] [varchar](10) NOT NULL,
	[TRIP_ID] [varchar](9) NOT NULL,
	[TRIP_DAY_ORDER] [int] NULL,
	[TRIP_DESCRIPTION] [text] NULL,
	[STAY_TIME] [float] NOT NULL,
	[SPOT_ID] [varchar](11) NOT NULL,
	[IMG_ID] [varchar](11) NOT NULL,
	[SPOT_ORDER] [int] NOT NULL,
	[TEMP_TRIP_DETAIL_ID] [varchar](10) NOT NULL,
 CONSTRAINT [PK__TRIP_DET__E05526C6FDF08AE5] PRIMARY KEY CLUSTERED 
(
	[TRIP_DETAIL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[TRIP_LIKE_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[TRIP_LIKE_RECORD](
	[ACCOUNT_ID] [varchar](9) NOT NULL,
	[TRIP_ID] [varchar](9) NOT NULL,
 CONSTRAINT [PK_TRIP_LIKE_RECORD] PRIMARY KEY CLUSTERED 
(
	[ACCOUNT_ID] ASC,
	[TRIP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
INSERT [dbo].[ACCOUNT] ([ACCOUNT_ID], [EMAIL], [PASSWORD], [NICKNAME], [ACCOUNT_LEVEL], [LAST_LOGON_DT], [IMAGE], [BLACKLIST_LEVEL]) VALUES (N'M14090001', N'user1@gmail.com', N'user1', N'user1', 1, CAST(0xEE380B00 AS Date), NULL, 1)
INSERT [dbo].[ACCOUNT] ([ACCOUNT_ID], [EMAIL], [PASSWORD], [NICKNAME], [ACCOUNT_LEVEL], [LAST_LOGON_DT], [IMAGE], [BLACKLIST_LEVEL]) VALUES (N'M14090002', N'', N'user1', N'user1', 1, CAST(0xEE380B00 AS Date), NULL, 1)
INSERT [dbo].[ACCOUNT] ([ACCOUNT_ID], [EMAIL], [PASSWORD], [NICKNAME], [ACCOUNT_LEVEL], [LAST_LOGON_DT], [IMAGE], [BLACKLIST_LEVEL]) VALUES (N'M14090003', N'user3@gmail.com', N'user3', N'user3', NULL, CAST(0xF7380B00 AS Date), NULL, NULL)
INSERT [dbo].[ACCOUNT] ([ACCOUNT_ID], [EMAIL], [PASSWORD], [NICKNAME], [ACCOUNT_LEVEL], [LAST_LOGON_DT], [IMAGE], [BLACKLIST_LEVEL]) VALUES (N'M14090004', N'user4@gmail.com', N'user4', N'user4', NULL, CAST(0xF7380B00 AS Date), NULL, NULL)
INSERT [dbo].[BLACKLIST_RECORD] ([REPORTER_ID], [REPORTED_ID], [COMMENT_ID], [REASON], [REPORT_DT]) VALUES (N'M14090001', N'M14090003', N'CMT140900001', N'liar', CAST(0xF7380B00 AS Date))
INSERT [dbo].[BLACKLIST_RECORD] ([REPORTER_ID], [REPORTED_ID], [COMMENT_ID], [REASON], [REPORT_DT]) VALUES (N'M14090002', N'M14090003', N'CMT140900001', N'liar', CAST(0xF7380B00 AS Date))
INSERT [dbo].[BLACKLIST_RECORD] ([REPORTER_ID], [REPORTED_ID], [COMMENT_ID], [REASON], [REPORT_DT]) VALUES (N'M14090002', N'M14090004', N'CMT140900002', N'liar', CAST(0xF7380B00 AS Date))
INSERT [dbo].[CODE_LIST] ([CODE_HEAD], [YYMM], [SER_NO], [DESCRIPTION]) VALUES (N'I', N'1409', 35, N'Spot Image')
INSERT [dbo].[CODE_LIST] ([CODE_HEAD], [YYMM], [SER_NO], [DESCRIPTION]) VALUES (N'M', N'1409', 4, N'ACCOUNT : M')
INSERT [dbo].[CODE_LIST] ([CODE_HEAD], [YYMM], [SER_NO], [DESCRIPTION]) VALUES (N'R', N'1409', 4, N'TRIP_DETAIL')
INSERT [dbo].[CODE_LIST] ([CODE_HEAD], [YYMM], [SER_NO], [DESCRIPTION]) VALUES (N'T', N'1409', 3, N'TRIP')
INSERT [dbo].[SER_NO_LENGTH] ([CODE_HEAD], [DESCRIPTION], [SER_NO_LENGTH]) VALUES (N'CMT', N'COMMENT', 5)
INSERT [dbo].[SER_NO_LENGTH] ([CODE_HEAD], [DESCRIPTION], [SER_NO_LENGTH]) VALUES (N'D', N'AD', 3)
INSERT [dbo].[SER_NO_LENGTH] ([CODE_HEAD], [DESCRIPTION], [SER_NO_LENGTH]) VALUES (N'I', N'SPOT IMGAGE', 5)
INSERT [dbo].[SER_NO_LENGTH] ([CODE_HEAD], [DESCRIPTION], [SER_NO_LENGTH]) VALUES (N'M', N'ACCOUNT', 4)
INSERT [dbo].[SER_NO_LENGTH] ([CODE_HEAD], [DESCRIPTION], [SER_NO_LENGTH]) VALUES (N'R', N'TRIP_DETAIL', 5)
INSERT [dbo].[SER_NO_LENGTH] ([CODE_HEAD], [DESCRIPTION], [SER_NO_LENGTH]) VALUES (N'T', N'TRIP', 4)
INSERT [dbo].[SPOT_COMMENT_RECORD] ([COMMENT_ID], [ACCOUNT_ID], [SPOT_ID], [COMMENT], [CMT_DT], [TEMP_COMMENT_ID]) VALUES (N'CMT140900002', N'M14090004', N'RES14090001', N'terrible', CAST(0xF7380B00 AS Date), N'CMT140900002')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090001', N'M14090001', N'leader1', N'一蘭拉麵', 1, NULL, NULL, NULL, NULL, N'日本拉麵', NULL, 1, N'RES', N'RES14090001')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090002', N'M14090001', N'leader1', N'一蘭拉麵', 1, NULL, NULL, NULL, NULL, N'日本拉麵', NULL, 1, N'RES', N'RES14090002')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090003', N'M14090001', N'leader1', N'一蘭拉麵', 1, NULL, NULL, NULL, NULL, N'日本拉麵', NULL, 1, N'RES', N'RES14090003')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090004', N'M14090001', N'leader1', N'一蘭拉麵', 1, NULL, NULL, NULL, NULL, N'日本拉麵', NULL, 1, N'RES', N'1ABC')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090007', N'M14090001', N'leader1', N'一蘭拉麵', 1, NULL, NULL, NULL, NULL, N'日本拉麵', NULL, 1, N'RES', N'RES14090007')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090008', N'M14090002', NULL, N'McDonald', 1, NULL, NULL, NULL, NULL, NULL, NULL, 1, N'RES', N'RES14090008')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090013', N'M14090002', NULL, N'McDonald', 1, N'Taipei City', NULL, NULL, NULL, NULL, NULL, 1, N'RES', N'RES14090013')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090014', N'M14090002', NULL, N'McDonald', 1, N'Taipei City', NULL, NULL, NULL, NULL, NULL, 1, N'RES', N'RES14090014')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090018', N'M14090002', NULL, N'Pizza', 1, N'Taipei City', NULL, NULL, NULL, NULL, NULL, 1, N'RES', N'RES14090018')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'RES14090019', N'M14090002', NULL, N'Pizza', 1, N'Taipei City', NULL, NULL, NULL, NULL, NULL, 1, N'RES', N'RES14090019')
INSERT [dbo].[SPOT_DETAIL] ([SPOT_ID], [ACCOUNT_ID], [LEADER], [SPOT_NAME], [CITY_ID], [ADDRESS], [PHONE], [LONGITUDE], [LATITUDE], [SPOT_INTRO], [LIKE_COUNT], [CATEGORY_ID], [SUBCATEGORY_ID], [TEMP_SPOT_ID]) VALUES (N'SWT14090001', N'M14090001', NULL, N'Brown Coffee', 1, NULL, NULL, NULL, NULL, NULL, NULL, 1, N'SWT', N'SWT14090001')
INSERT [dbo].[SPOT_IMG] ([IMG_ID], [SPOT_ID], [SPOT_IMG], [IMG_ORDER], [TEMP_IMG_ID]) VALUES (N'I140900024', N'RES14090001', NULL, 1, N'I140900024')
INSERT [dbo].[SPOT_IMG] ([IMG_ID], [SPOT_ID], [SPOT_IMG], [IMG_ORDER], [TEMP_IMG_ID]) VALUES (N'I140900025', N'RES14090001', NULL, 2, N'I140900025')
INSERT [dbo].[SPOT_IMG] ([IMG_ID], [SPOT_ID], [SPOT_IMG], [IMG_ORDER], [TEMP_IMG_ID]) VALUES (N'I140900026', N'RES14090001', NULL, 3, N'I140900026')
INSERT [dbo].[SPOT_IMG] ([IMG_ID], [SPOT_ID], [SPOT_IMG], [IMG_ORDER], [TEMP_IMG_ID]) VALUES (N'I140900027', N'RES14090001', NULL, 1, N'I140900027')
INSERT [dbo].[SPOT_IMG] ([IMG_ID], [SPOT_ID], [SPOT_IMG], [IMG_ORDER], [TEMP_IMG_ID]) VALUES (N'I140900028', N'RES14090001', NULL, 2, N'I140900028')
INSERT [dbo].[SPOT_IMG] ([IMG_ID], [SPOT_ID], [SPOT_IMG], [IMG_ORDER], [TEMP_IMG_ID]) VALUES (N'I140900029', N'RES14090001', NULL, 3, N'I140900029')
INSERT [dbo].[SPOT_LIKE_RECORD] ([ACCOUNT_ID], [SPOT_ID]) VALUES (N'M14090001', N'RES14090001')
INSERT [dbo].[SPOT_LIKE_RECORD] ([ACCOUNT_ID], [SPOT_ID]) VALUES (N'M14090001', N'RES14090004')
INSERT [dbo].[SPOT_LIKE_RECORD] ([ACCOUNT_ID], [SPOT_ID]) VALUES (N'M14090002', N'RES14090004')
INSERT [dbo].[TRIP] ([TRIP_ID], [TRIP_NAME], [ACCOUNT_ID], [TOTAL_DAY], [START_DATE], [LIKE_COUNT], [TEMP_TRIP_ID]) VALUES (N'T14090003', N'5D4N', N'M14090001', NULL, CAST(0xFB380B00 AS Date), NULL, N'T14090003')
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__ACCOUNT__161CF7247DE45A51]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[ACCOUNT] ADD  CONSTRAINT [UQ__ACCOUNT__161CF7247DE45A51] UNIQUE NONCLUSTERED 
(
	[EMAIL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__AD__AF586223738C7A8C]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[AD] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_AD_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__COUPONS__8765426E2D8AD934]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[COUPONS] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_COUPON_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__SPOT_COM__64A40B1F3437E17F]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[SPOT_COMMENT_RECORD] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_COMMENT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__SPOT_DET__1045A388B4F32178]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[SPOT_DETAIL] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_SPOT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__SPOT_IMG__D0FA11D9D1CF994B]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[SPOT_IMG] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_IMG_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__TRIP__8E29D83381808E61]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[TRIP] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_TRIP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ__TRIP_DET__B7E1531204B0D470]    Script Date: 2014/9/8 下午 06:01:08 ******/
ALTER TABLE [dbo].[TRIP_DETAIL] ADD UNIQUE NONCLUSTERED 
(
	[TEMP_TRIP_DETAIL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
ALTER TABLE [dbo].[AD]  WITH CHECK ADD  CONSTRAINT [FK__AD__SPOT_ID__05D8E0BE] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
GO
ALTER TABLE [dbo].[AD] CHECK CONSTRAINT [FK__AD__SPOT_ID__05D8E0BE]
GO
ALTER TABLE [dbo].[COUPONS]  WITH CHECK ADD  CONSTRAINT [FK_COUPONS_SPOT] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[COUPONS] CHECK CONSTRAINT [FK_COUPONS_SPOT]
GO
ALTER TABLE [dbo].[SPOT_COLLECT_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_COLLECT_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_COLLECT_RECORD] CHECK CONSTRAINT [FK_SPOT_COLLECT_ACCOUNT]
GO
ALTER TABLE [dbo].[SPOT_COLLECT_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_COLLECT_SPOT] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_COLLECT_RECORD] CHECK CONSTRAINT [FK_SPOT_COLLECT_SPOT]
GO
ALTER TABLE [dbo].[SPOT_COMMENT_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_COMMENT_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_COMMENT_RECORD] CHECK CONSTRAINT [FK_SPOT_COMMENT_ACCOUNT]
GO
ALTER TABLE [dbo].[SPOT_COMMENT_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_COMMENT_SPOT] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_COMMENT_RECORD] CHECK CONSTRAINT [FK_SPOT_COMMENT_SPOT]
GO
ALTER TABLE [dbo].[SPOT_DETAIL]  WITH CHECK ADD  CONSTRAINT [FK__SPOT_DETA__ACCOU__47A6A41B] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
GO
ALTER TABLE [dbo].[SPOT_DETAIL] CHECK CONSTRAINT [FK__SPOT_DETA__ACCOU__47A6A41B]
GO
ALTER TABLE [dbo].[SPOT_IMG]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_IMG_SPOT] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_IMG] CHECK CONSTRAINT [FK_SPOT_IMG_SPOT]
GO
ALTER TABLE [dbo].[SPOT_LIKE_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_LIKE_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_LIKE_RECORD] CHECK CONSTRAINT [FK_SPOT_LIKE_ACCOUNT]
GO
ALTER TABLE [dbo].[SPOT_LIKE_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_LIKE_SPOT] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[SPOT_LIKE_RECORD] CHECK CONSTRAINT [FK_SPOT_LIKE_SPOT]
GO
ALTER TABLE [dbo].[SPOT_OWNER]  WITH CHECK ADD  CONSTRAINT [FK_SPOT_OWNER_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
GO
ALTER TABLE [dbo].[SPOT_OWNER] CHECK CONSTRAINT [FK_SPOT_OWNER_ACCOUNT]
GO
ALTER TABLE [dbo].[TRIP]  WITH CHECK ADD  CONSTRAINT [FK__TRIP__ACCOUNT_ID__286302EC] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
GO
ALTER TABLE [dbo].[TRIP] CHECK CONSTRAINT [FK__TRIP__ACCOUNT_ID__286302EC]
GO
ALTER TABLE [dbo].[TRIP]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
GO
ALTER TABLE [dbo].[TRIP] CHECK CONSTRAINT [FK_TRIP_ACCOUNT]
GO
ALTER TABLE [dbo].[TRIP_COLLECT_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_COLLECT_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TRIP_COLLECT_RECORD] CHECK CONSTRAINT [FK_TRIP_COLLECT_ACCOUNT]
GO
ALTER TABLE [dbo].[TRIP_COLLECT_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_COLLECT_TRIP] FOREIGN KEY([TRIP_ID])
REFERENCES [dbo].[TRIP] ([TRIP_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TRIP_COLLECT_RECORD] CHECK CONSTRAINT [FK_TRIP_COLLECT_TRIP]
GO
ALTER TABLE [dbo].[TRIP_DETAIL]  WITH CHECK ADD  CONSTRAINT [FK__TRIP_DETA__SPOT___6383C8BA] FOREIGN KEY([SPOT_ID])
REFERENCES [dbo].[SPOT_DETAIL] ([SPOT_ID])
GO
ALTER TABLE [dbo].[TRIP_DETAIL] CHECK CONSTRAINT [FK__TRIP_DETA__SPOT___6383C8BA]
GO
ALTER TABLE [dbo].[TRIP_DETAIL]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_DETAIL_IMG] FOREIGN KEY([IMG_ID])
REFERENCES [dbo].[SPOT_IMG] ([IMG_ID])
GO
ALTER TABLE [dbo].[TRIP_DETAIL] CHECK CONSTRAINT [FK_TRIP_DETAIL_IMG]
GO
ALTER TABLE [dbo].[TRIP_DETAIL]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_DETAIL_TRIP] FOREIGN KEY([TRIP_ID])
REFERENCES [dbo].[TRIP] ([TRIP_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TRIP_DETAIL] CHECK CONSTRAINT [FK_TRIP_DETAIL_TRIP]
GO
ALTER TABLE [dbo].[TRIP_LIKE_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_LIKE_ACCOUNT] FOREIGN KEY([ACCOUNT_ID])
REFERENCES [dbo].[ACCOUNT] ([ACCOUNT_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TRIP_LIKE_RECORD] CHECK CONSTRAINT [FK_TRIP_LIKE_ACCOUNT]
GO
ALTER TABLE [dbo].[TRIP_LIKE_RECORD]  WITH CHECK ADD  CONSTRAINT [FK_TRIP_LIKE_TRIP] FOREIGN KEY([TRIP_ID])
REFERENCES [dbo].[TRIP] ([TRIP_ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TRIP_LIKE_RECORD] CHECK CONSTRAINT [FK_TRIP_LIKE_TRIP]
GO
/****** Object:  Trigger [dbo].[T_ACCOUNT]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_ACCOUNT] 
   ON  [dbo].[ACCOUNT]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON; -- for what???
	DECLARE @codeLength INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @yymm VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @newSER_NO INT
	DECLARE @newAccount VARCHAR(9)

	-- 1.設定或取得相關變數
	SET @yymm = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SELECT @CODE_HEAD = 'M'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @codeLength=SER_NO_Length
	FROM SER_NO_LENGTH
	WHERE CODE_HEAD = @CODE_HEAD

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @codeLength IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=ser_No FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND yymm = @yymm

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @newSER_NO = 1

			INSERT INTO CODE_LIST(code_Head, yymm, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @yymm, @newSER_NO, 'ACCOUNT : '+@code_Head)	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @newSER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @newSER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND yymm = @yymm
		END
	
	-- 取得 P-KEY 號碼
	SET @newAccount = 
			@CODE_HEAD + 
			@yymm + 
			(REPLICATE('0',(@codeLength-LEN(@newSER_NO))) + RTRIM(CAST(@newSER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	-- 若原本insert null則inserted???
	INSERT INTO ACCOUNT (
						ACCOUNT_ID,
						EMAIL,
						PASSWORD,
						NICKNAME,
						ACCOUNT_LEVEL,
						LAST_LOGON_DT,
						IMAGE,
						BLACKLIST_LEVEL
							 )
					SELECT  @newAccount, 
							INSERTED.EMAIL, 
							INSERTED.PASSWORD,
							INSERTED.NICKNAME, 
							INSERTED.ACCOUNT_LEVEL,
							INSERTED.LAST_LOGON_DT,
							INSERTED.IMAGE, 
							INSERTED.BLACKLIST_LEVEL
					FROM INSERTED	
END




GO
/****** Object:  Trigger [dbo].[T_AD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_AD] 
   ON  [dbo].[AD]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON;
	DECLARE @SER_NO_LENGTH INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @YYMM VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @NEW_SER_NO INT
	DECLARE @NEW_AD_ID VARCHAR(8)

	-- 1.設定或取得相關變數
	SET @YYMM = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SET @CODE_HEAD = 'D'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @SER_NO_LENGTH=SER_NO_LENGTH
	FROM SER_NO_LENGTH 
	WHERE CODE_HEAD = @CODE_HEAD

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @SER_NO_LENGTH IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=SER_NO FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND YYMM = @YYMM

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @NEW_SER_NO = 1

			INSERT INTO CODE_LIST(CODE_HEAD, YYMM, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @YYMM, @NEW_SER_NO, 'AD')	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @NEW_SER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @NEW_SER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND YYMM = @YYMM
		END
	
	-- 取得 P-KEY 號碼
	SET @NEW_AD_ID = 
			@CODE_HEAD + 
			@YYMM + 
			(REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	INSERT INTO AD (AD_ID, 
					SPOT_ID, 
					AD_IMG, 
					VALID_DAY,
					TEMP_AD_ID)
			SELECT  @NEW_AD_ID, 
					INSERTED.SPOT_ID, 
					INSERTED.AD_IMG,
					INSERTED.VALID_DAY,
					INSERTED.TEMP_AD_ID
			   FROM INSERTED	
END




GO
/****** Object:  Trigger [dbo].[T_COUPONS]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_COUPONS] 
   ON  [dbo].[COUPONS]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON;
	DECLARE @SER_NO_LENGTH INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @YYMM VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @NEW_SER_NO INT
	DECLARE @NEW_COUPON_ID VARCHAR(8)

	-- 1.設定或取得相關變數
	SET @YYMM = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SET @CODE_HEAD = 'C'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @SER_NO_LENGTH=SER_NO_LENGTH
	FROM SER_NO_LENGTH 
	WHERE CODE_HEAD = @CODE_HEAD

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @SER_NO_LENGTH IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=SER_NO FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND YYMM = @YYMM

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @NEW_SER_NO = 1

			INSERT INTO CODE_LIST(CODE_HEAD, YYMM, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @YYMM, @NEW_SER_NO, 'COUPON')	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @NEW_SER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @NEW_SER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND YYMM = @YYMM
		END
	
	-- 取得 P-KEY 號碼
	SET @NEW_COUPON_ID = 
			@CODE_HEAD + 
			@YYMM + 
			(REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	INSERT INTO COUPONS (COUPON_ID, 
						SPOT_ID, 
						COUPON_IMG, 
						COUPON_DESCRIPTION,
						VALID_DAY,
						TEMP_COUPON_ID)
				SELECT  @NEW_COUPON_ID, 
						INSERTED.SPOT_ID, 
						INSERTED.COUPON_IMG,
						INSERTED.COUPON_DESCRIPTION,
						INSERTED.VALID_DAY,
						INSERTED.TEMP_COUPON_ID
				   FROM INSERTED	
END




GO
/****** Object:  Trigger [dbo].[T_SPOT_COMMENT_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_SPOT_COMMENT_RECORD] 
   ON  [dbo].[SPOT_COMMENT_RECORD]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON; -- for what???
	DECLARE @codeLength INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @yymm VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @newSER_NO INT
	DECLARE @newCmdRecId VARCHAR(12)

	-- 1.設定或取得相關變數
	SET @yymm = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SELECT @CODE_HEAD = 'CMT'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @codeLength=SER_NO_Length
	FROM SER_NO_LENGTH
	WHERE CODE_HEAD = @CODE_HEAD

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @codeLength IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=ser_No FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND yymm = @yymm

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @newSER_NO = 1

			INSERT INTO CODE_LIST(code_Head, yymm, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @yymm, @newSER_NO, 'SPOT_DETAIL : '+@code_Head)	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @newSER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @newSER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND yymm = @yymm
		END
	
	-- 取得 P-KEY 號碼
	SET @newCmdRecId = 
			@CODE_HEAD + 
			@yymm + 
			(REPLICATE('0',(@codeLength-LEN(@newSER_NO))) + RTRIM(CAST(@newSER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	-- 若原本insert null則inserted???
	INSERT INTO SPOT_COMMENT_RECORD (
							 COMMENT_ID, 
							 ACCOUNT_ID, 
							 SPOT_ID, 
							 COMMENT,
							 CMT_DT,
							 TEMP_COMMENT_ID
							 )
					SELECT  @newCmdRecId, 
							INSERTED.ACCOUNT_ID, 
							INSERTED.SPOT_ID,
							INSERTED.COMMENT, 
							INSERTED.CMT_DT,
							INSERTED.TEMP_COMMENT_ID
					FROM INSERTED	
END



GO
/****** Object:  Trigger [dbo].[T_SPOT_DETAIL]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE TRIGGER [dbo].[T_SPOT_DETAIL] 
   ON  [dbo].[SPOT_DETAIL]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON; -- for what???
	DECLARE @codeLength INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @yymm VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @newSER_NO INT
	DECLARE @newSpotId VARCHAR(11)

	-- 1.設定或取得相關變數
	SET @yymm = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SELECT @CODE_HEAD = INSERTED.SUBCATEGORY_ID FROM INSERTED

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SET @codeLength=4
/*	SELECT @codeLength=SER_NO_Length
	FROM SER_NO_LENGTH
	WHERE CODE_HEAD = @CODE_HEAD
	*/

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @codeLength IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=ser_No FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND yymm = @yymm

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @newSER_NO = 1

			INSERT INTO CODE_LIST(code_Head, yymm, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @yymm, @newSER_NO, 'SPOT_DETAIL : '+@code_Head)	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @newSER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @newSER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND yymm = @yymm
		END
	
	-- 取得 P-KEY 號碼
	SET @newSpotId = 
			@CODE_HEAD + 
			@yymm + 
			(REPLICATE('0',(@codeLength-LEN(@newSER_NO))) + RTRIM(CAST(@newSER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	-- 若原本insert null則inserted???
	INSERT INTO SPOT_DETAIL (SPOT_ID, 
							 ACCOUNT_ID, 
							 LEADER, 
							 SPOT_NAME,
							 CITY_ID,
							 address,
							 phone,
							 longitude,
							 latitude,
							 SPOT_INTRO,
							 CATEGORY_ID,
							 SUBCATEGORY_ID,
							 LIKE_COUNT,
							 TEMP_SPOT_ID)
					SELECT  @newSpotId, 
							INSERTED.ACCOUNT_ID, 
							INSERTED.leader,
							INSERTED.SPOT_NAME, 
							INSERTED.CITY_ID,
							INSERTED.address,
							INSERTED.phone, 
							INSERTED.longitude,
							INSERTED.latitude, 
							INSERTED.SPOT_INTRO,
							INSERTED.CATEGORY_ID,
							INSERTED.SUBCATEGORY_ID,
							INSERTED.LIKE_COUNT,
							INSERTED.TEMP_SPOT_ID
					FROM INSERTED	
END



GO
/****** Object:  Trigger [dbo].[T_SPOT_IMG]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_SPOT_IMG] 
   ON  [dbo].[SPOT_IMG]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON;
	DECLARE @codeLength INT
	DECLARE @codeHead VARCHAR(4)
	DECLARE @yymm VARCHAR(4)
	DECLARE @serNo INT
	DECLARE @newSerNo INT
	DECLARE @newImgId VARCHAR(10)

	-- 1.設定或取得相關變數
	SET @yymm = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SET @codeHead = 'I'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @codeLength=SER_NO_LENGTH
	FROM SER_NO_LENGTH
	WHERE code_Head = @codeHead

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @codeLength IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @serNo=ser_No FROM CODE_LIST
	WHERE code_Head = @codeHead
	AND yymm = @yymm

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @serNo IS NULL
		BEGIN
			SET @newSerNo = 1

			INSERT INTO CODE_LIST(code_Head, yymm, ser_No, DESCRIPTION)
						   VALUES(@codeHead, @yymm, @newSerNo, 'Spot Image')	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @newSerNo = @serNo + 1

			UPDATE CODE_LIST SET ser_No = @newSerNo
			WHERE code_Head = @codeHead
			AND yymm = @yymm
		END
	
	-- 取得 P-KEY 號碼
	SET @newImgId = 
			@codeHead + 
			@yymm + 
			(REPLICATE('0',(@codeLength-LEN(@newSerNo))) + RTRIM(CAST(@newSerNo AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	INSERT INTO SPOT_IMG (img_Id, 
							spot_Id, 
							spot_Img,
							TEMP_IMG_ID)
					SELECT  @newImgId, 
							INSERTED.spot_Id, 
							INSERTED.spot_Img,
							INSERTED.TEMP_IMG_ID
					FROM INSERTED	
END



GO
/****** Object:  Trigger [dbo].[T_SPOT_LIKE_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_SPOT_LIKE_RECORD] 
   ON  [dbo].[SPOT_LIKE_RECORD]
   AFTER UPDATE, INSERT, DELETE
AS 
BEGIN
	SET NOCOUNT ON;
	DECLARE @SPOT_ID VARCHAR(11)
	
	-- INSERT
	IF EXISTS(SELECT * FROM INSERTED)
	BEGIN
		SELECT @SPOT_ID = INSERTED.SPOT_ID FROM INSERTED
		UPDATE SPOT_DETAIL SET LIKE_COUNT = ISNULL(LIKE_COUNT,0) + 1
		WHERE SPOT_ID = @SPOT_ID
	END
	
	IF EXISTS(SELECT * FROM DELETED)
	BEGIN
		SELECT @SPOT_ID = DELETED.SPOT_ID FROM DELETED
		UPDATE SPOT_DETAIL SET LIKE_COUNT = LIKE_COUNT - 1
		WHERE SPOT_ID = @SPOT_ID
	END
END




GO
/****** Object:  Trigger [dbo].[T_TRIP]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_TRIP] 
   ON  [dbo].[TRIP]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON; -- for what???
	DECLARE @codeLength INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @yymm VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @newSER_NO INT
	DECLARE @newTRIPId VARCHAR(11)

	-- 1.設定或取得相關變數
	SET @yymm = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SET @CODE_HEAD = 'T'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @codeLength=SER_NO_Length
	FROM SER_NO_LENGTH
	WHERE CODE_HEAD = @CODE_HEAD

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @codeLength IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=ser_No FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND yymm = @yymm

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @newSER_NO = 1

			INSERT INTO CODE_LIST(code_Head, yymm, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @yymm, @newSER_NO, 'TRIP')	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @newSER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @newSER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND yymm = @yymm
		END
	
	-- 取得 P-KEY 號碼
	SET @newTRIPId = 
			@CODE_HEAD + 
			@yymm + 
			(REPLICATE('0',(@codeLength-LEN(@newSER_NO))) + RTRIM(CAST(@newSER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	-- 若原本insert null則inserted???
	INSERT INTO TRIP 		(TRIP_ID, 
							 TRIP_NAME, 
							 ACCOUNT_ID, 
							 TOTAL_DAY,
							 START_DATE,
							 LIKE_COUNT,
							 TEMP_TRIP_ID)
					SELECT  @newTRIPId, 
							INSERTED.TRIP_NAME, 
							INSERTED.ACCOUNT_ID,
							INSERTED.TOTAL_DAY, 
							INSERTED.START_DATE,
							INSERTED.LIKE_COUNT,
							INSERTED.TEMP_TRIP_ID
					FROM INSERTED	
END




GO
/****** Object:  Trigger [dbo].[T_TRIP_DETAIL]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_TRIP_DETAIL] 
   ON  [dbo].[TRIP_DETAIL]
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON; -- for what???
	DECLARE @codeLength INT
	DECLARE @CODE_HEAD VARCHAR(4)
	DECLARE @yymm VARCHAR(4)
	DECLARE @SER_NO INT
	DECLARE @newSER_NO INT
	DECLARE @new_TRIP_DETAIL_Id VARCHAR(11)

	-- 1.設定或取得相關變數
	SET @yymm = SUBSTRING((convert(char(6), getdate(), 112)),3,4)
	SET @CODE_HEAD = 'R'

	-- 2.以CODE_HEAD 去SER_LENGTH表取得序號長度
	SELECT @codeLength=SER_NO_Length
	FROM SER_NO_LENGTH
	WHERE CODE_HEAD = @CODE_HEAD

	-- 若沒設定SER_LENGTH, 則 RAISE ERROR
	IF @codeLength IS NULL
		BEGIN
			RAISERROR(
			'Please create Code Head Length first',16,1)
			ROLLBACK TRANSACTION
		END

	-- 3.以CODE_HEAD + YYMM 去編碼表取目前最大序號
	SELECT @SER_NO=ser_No FROM CODE_LIST
	WHERE CODE_HEAD = @CODE_HEAD
	AND yymm = @yymm

	-- CODE_LIST 沒有則 INSERT 一筆
	IF @SER_NO IS NULL
		BEGIN
			SET @newSER_NO = 1

			INSERT INTO CODE_LIST(code_Head, yymm, SER_NO, DESCRIPTION)
						   VALUES(@CODE_HEAD, @yymm, @newSER_NO, 'TRIP_DETAIL')	
		END
	
	-- CODE_LIST 有則 UPDATE
	ELSE
		BEGIN
			SET @newSER_NO = @SER_NO + 1

			UPDATE CODE_LIST SET SER_NO = @newSER_NO
			WHERE CODE_HEAD = @CODE_HEAD
			AND yymm = @yymm
		END
	
	-- 取得 P-KEY 號碼
	SET @new_TRIP_DETAIL_Id = 
			@CODE_HEAD + 
			@yymm + 
			(REPLICATE('0',(@codeLength-LEN(@newSER_NO))) + RTRIM(CAST(@newSER_NO AS CHAR)) )

	--SELECT  (REPLICATE('0',(@SER_NO_LENGTH-LEN(@NEW_SER_NO))) + RTRIM(CAST(@NEW_SER_NO AS CHAR)) )
	--SELECT @NEW_COMMERCIAL_ID
	
	-- 將資料寫回原TABLE
	-- 若原本insert null則inserted???
	INSERT INTO TRIP_DETAIL	(TRIP_DETAIL_ID, 
							 TRIP_ID, 
							 TRIP_DAY_ORDER, 
							 TRIP_DESCRIPTION,
							 STAY_TIME,
							 SPOT_ID,
							 IMG_ID,
							 SPOT_ORDER,
							 TEMP_TRIP_DETAIL_ID
							 )
					SELECT  @new_TRIP_DETAIL_Id, 
							INSERTED.TRIP_ID, 
							INSERTED.TRIP_DAY_ORDER,
							INSERTED.TRIP_DESCRIPTION,
							INSERTED.STAY_TIME, 
							INSERTED.SPOT_ID,
							INSERTED.IMG_ID,
							INSERTED.SPOT_ORDER,
							INSERTED.TEMP_TRIP_DETAIL_ID
					FROM INSERTED	
END


GO
/****** Object:  Trigger [dbo].[T_TRIP_LIKE_RECORD]    Script Date: 2014/9/8 下午 06:01:08 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TRIGGER [dbo].[T_TRIP_LIKE_RECORD] 
   ON  [dbo].[TRIP_LIKE_RECORD]
   AFTER UPDATE, INSERT, DELETE
AS 
BEGIN
	SET NOCOUNT ON;
	DECLARE @TRIP_ID VARCHAR(11)
	
	-- INSERT
	IF EXISTS(SELECT * FROM INSERTED)
	BEGIN
		SELECT @TRIP_ID = INSERTED.TRIP_ID FROM INSERTED
		UPDATE TRIP SET LIKE_COUNT = ISNULL(LIKE_COUNT,0) + 1
		WHERE TRIP_ID = @TRIP_ID
	END
	
	IF EXISTS(SELECT * FROM DELETED)
	BEGIN
		SELECT @TRIP_ID = DELETED.TRIP_ID FROM DELETED
		UPDATE TRIP SET LIKE_COUNT = LIKE_COUNT - 1
		WHERE TRIP_ID = @TRIP_ID
	END
END




GO
USE [master]
GO
ALTER DATABASE [iiiTravel] SET  READ_WRITE 
GO
